# Classes Firebase Integration Guide

## ๐ Overview
ุชู ุฑุจุท ูุธุงู ุฅุฏุงุฑุฉ ุงูุตููู ุจุงููุงูู ูุน Firebase Firestore ูุฌุนูู ูุธุงููุง ุญูููููุง ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูููููุฉ.

## ๐๏ธ Database Structure

### Collection: `classes`
```typescript
{
  id: string;                    // Auto-generated by Firestore
  name: string;                  // ุงุณู ุงูุตู (ูุซู: ุงูุตู ุงูุฃูู ุงูุซุงููู - ุงููุฌููุนุฉ A)
  subject: string;               // ุงููุงุฏุฉ (ูุซู: ุงูุฑูุงุถูุงุช)
  schedule: string;              // ุงูููุนุฏ (ูุซู: ุงูุณุจุช ูุงูุซูุงุซุงุก - 4:00 ูุณุงุกู)
  duration: string;              // ุงููุฏุฉ (ูุซู: ุณุงุนุชุงู)
  price: string;                 // ุงูุณุนุฑ (ูุซู: 300 ุฌููู/ุดูุฑ)
  maxStudents: number;           // ุงูุญุฏ ุงูุฃูุตู ููุทูุงุจ
  studentsCount: number;         // ุนุฏุฏ ุงูุทูุงุจ ุงูุญุงูููู
  isActive: boolean;             // ูู ุงูุตู ูุดุท ููุชุงุญ ููุงุดุชุฑุงู
  teacherId: string;             // ูุนุฑู ุงููุฏุฑุณ (ูุงูู ุงูุตู)
  createdAt: Timestamp;          // ุชุงุฑูุฎ ุงูุฅูุดุงุก
  updatedAt: Timestamp;          // ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
}
```

## ๐ Security Rules

ุชู ุฅุถุงูุฉ ููุงุนุฏ ุงูุฃูุงู ุงูุชุงููุฉ ูู `firestore.rules`:

```javascript
// Classes collection
match /classes/{classId} {
  // Anyone can read classes to view available classes
  allow read: if true;
  
  // Teachers can create their own classes
  allow create: if isTeacher() && request.resource.data.teacherId == request.auth.uid;
  
  // Teachers can update their own classes
  // Super admins can update any class
  allow update: if isSuperAdmin() 
                || (isTeacher() && resource.data.teacherId == request.auth.uid);
  
  // Teachers can delete their own classes
  // Super admins can delete any class
  allow delete: if isSuperAdmin() 
                || (isTeacher() && resource.data.teacherId == request.auth.uid);
}
```

### ุงูููุงุนุฏ ุชุณูุญ ุจู:
- โ **ุงููุฑุงุกุฉ**: ุงูุฌููุน (ูุนุฑุถ ุงูุตููู ุงููุชุงุญุฉ ูู ุงูุตูุญุฉ ุงูุนุงูุฉ)
- โ **ุงูุฅูุดุงุก**: ุงููุฏุฑุณูู ููุท (ูุตููููู ุงูุฎุงุตุฉ)
- โ **ุงูุชุญุฏูุซ**: ุงููุฏุฑุณ ุงููุงูู + ุงููุณุคูู ุงูุนุงู
- โ **ุงูุญุฐู**: ุงููุฏุฑุณ ุงููุงูู + ุงููุณุคูู ุงูุนุงู

## ๐ Modified Files

### 1. `/src/app/dashboard/teacher/classes/page.tsx`
**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ Firebase imports (collection, query, where, getDocs, addDoc, updateDoc, deleteDoc)
- โ ุชุญููู ูู ุจูุงูุงุช ููููุฉ ุฅูู ุจูุงูุงุช ุญููููุฉ ูู Firestore
- โ ุฅุถุงูุฉ ุฏุงูุฉ `loadClasses()` ูุชุญููู ุงูุตููู ูู Firebase
- โ ุฅุถุงูุฉ ุฏุงูุฉ `handleSubmit()` ูุฅุถุงูุฉ/ุชุนุฏูู ุงูุตููู
- โ ุฅุถุงูุฉ ุฏุงูุฉ `handleEdit()` ูุชุนุฏูู ุตู ููุฌูุฏ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `handleDelete()` ูุญุฐู ุตู
- โ ุฅุถุงูุฉ Modal ูุงูู ูุฅุถุงูุฉ ูุชุนุฏูู ุงูุตููู
- โ ุฅุถุงูุฉ ุญุงูุฉ loading ุฃุซูุงุก ุงูุชุญููู

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**
- โจ ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุตู ุจุงููุงูู
- โจ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (required fields)
- โจ ุฑุณุงุฆู ุชุฃููุฏ ูุจู ุงูุญุฐู
- โจ ุชุญุฏูุซ ุชููุงุฆู ูููุงุฆูุฉ ุจุนุฏ ุฃู ุชุบููุฑ

### 2. `/src/app/teacher/[id]/page.tsx`
**ุงูุชุบููุฑุงุช:**
- โ ุฅุฒุงูุฉ ุงูุจูุงูุงุช ุงูููููุฉ `mockClasses`
- โ ุฅุถุงูุฉ state `classes` ู `setClasses`
- โ ุฅุถุงูุฉ interface `ClassItem`
- โ ุฅุถุงูุฉ ุฏุงูุฉ `loadClasses()` ูุชุญููู ุงูุตููู ูู Firebase
- โ ุนุฑุถ ุงูุตููู ุงููุดุทุฉ ููุท (`isActive == true`)
- โ ุฅุถุงูุฉ ุฑุณุงูุฉ "ูุง ุชูุฌุฏ ุตููู ูุชุงุญุฉ" ุนูุฏ ุนุฏู ูุฌูุฏ ุตููู

**ุงูููุฒุงุช:**
- โจ ุชุญููู ุงูุตููู ุงูุญููููุฉ ูู Firebase
- โจ ุนุฑุถ ุนุฏุฏ ุงูุตููู ุงููุนูู ูู ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช
- โจ ุงูุชุญูู ูู ุชููุฑ ุงูุฃูุงูู ุชููุงุฆููุง

### 3. `/src/app/subscribe/page.tsx`
**ุงูุชุบููุฑุงุช:**
- โ ุฅุฒุงูุฉ ุงูุจูุงูุงุช ุงูููููุฉ `mockClasses`
- โ ุฅุถุงูุฉ state `selectedClass` ูุชุญููู ุจูุงูุงุช ุงูุตู
- โ ุฅุถุงูุฉ interface `ClassItem` ูุญููุฉ
- โ ุชุญููู ุจูุงูุงุช ุงูุตู ูู Firebase ุจุงุณุชุฎุฏุงู `getDoc`
- โ ุนุฑุถ ุชูุงุตูู ุงูุตู ุงููุงููุฉ (ุงูููุนุฏุ ุงููุฏุฉุ ุงูุณุนุฑ)

**ุงูููุฒุงุช:**
- โจ ุชุญููู ุจูุงูุงุช ุงูุตู ุงูุญููููุฉ ูู Firebase
- โจ ุนุฑุถ ุฌููุน ุชูุงุตูู ุงูุตู (ุงูููุนุฏุ ุงููุฏุฉ)
- โจ ุงูุชุญูู ูู ูุฌูุฏ ุงูุตู ูุจู ุนุฑุถ ุงููููุฐุฌ

### 4. `/firestore.rules`
**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ ููุงุนุฏ ุฃูุงู ุฌุฏูุฏุฉ ููุฌููุนุฉ `classes`
- โ ุงูุณูุงุญ ููุฌููุน ุจุงููุฑุงุกุฉ (ูุนุฑุถ ุงูุตููู ุงูุนุงูุฉ)
- โ ุงูุณูุงุญ ูููุฏุฑุณูู ุจุฅุฏุงุฑุฉ ุตููููู ููุท

### 5. `/src/types/index.ts`
**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ ุญูู `updatedAt` ุฅูู `PendingSubscription`
- โ ุชู ุจุงููุนู ุชุนุฑูู interface `Class` (ูููู ุงุณุชุฎุฏุงูู ูุงุญููุง)

## ๐ Usage

### ูููุฏุฑุณ - ุฅุถุงูุฉ ุตู ุฌุฏูุฏ:
1. ุงูุชูู ุฅูู `/dashboard/teacher/classes`
2. ุงุถุบุท ุนูู "ุฅุถุงูุฉ ุตู ุฌุฏูุฏ"
3. ุงููุฃ ุงูุจูุงูุงุช:
   - ุงุณู ุงูุตู (ูุซู: ุงูุตู ุงูุฃูู ุงูุซุงููู - ุงููุฌููุนุฉ A)
   - ุงููุงุฏุฉ (ูุซู: ุงูุฑูุงุถูุงุช)
   - ุงูููุนุฏ (ูุซู: ุงูุณุจุช ูุงูุซูุงุซุงุก - 4:00 ูุณุงุกู)
   - ูุฏุฉ ุงูุญุตุฉ (ูุซู: ุณุงุนุชุงู)
   - ุงูุณุนุฑ ุงูุดูุฑู (ูุซู: 300 ุฌููู/ุดูุฑ)
   - ุงูุญุฏ ุงูุฃูุตู ููุทูุงุจ (ุฑูู)
   - โ ุงูุตู ูุดุท ููุชุงุญ ููุงุดุชุฑุงู (checkbox)
4. ุงุถุบุท "ุฅุถุงูุฉ ุงูุตู"

### ูููุฏุฑุณ - ุชุนุฏูู ุตู:
1. ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตููู
2. ุงุถุบุท ุนูู ุฃููููุฉ โ๏ธ ุจุฌุงูุจ ุงูุตู
3. ุนุฏูู ุงูุจูุงูุงุช ุงููุทููุจุฉ
4. ุงุถุบุท "ุญูุธ ุงูุชุนุฏููุงุช"

### ูููุฏุฑุณ - ุญุฐู ุตู:
1. ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตููู
2. ุงุถุบุท ุนูู ุฃููููุฉ ๐๏ธ ุจุฌุงูุจ ุงูุตู
3. ุฃููุฏ ุนูููุฉ ุงูุญุฐู

### ููุทุงูุจ - ุนุฑุถ ุงูุตููู ุงููุชุงุญุฉ:
1. ุงูุชูู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
2. ุงุฎุชุฑ ุงููุฏุฑุณ
3. ุณูุชู ุนุฑุถ ุงูุตููู ุงููุดุทุฉ ููุท (`isActive: true`)
4. ุงุถุบุท "ุงุดุชุฑู ุงูุขู" ููุงุดุชุฑุงู ูู ุงูุตู

## ๐ Statistics

ุงูุฅุญุตุงุฆูุงุช ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงูุตููู:
- **ุฅุฌูุงูู ุงูุตููู**: ุนุฏุฏ ุฌููุน ุงูุตููู
- **ุงูุตููู ุงููุดุทุฉ**: ุงูุตููู ุงูุชู `isActive: true`
- **ุฅุฌูุงูู ุงูุทูุงุจ**: ูุฌููุน `studentsCount` ูุฌููุน ุงูุตููู
- **ุงูุฃูุงูู ุงููุชุงุญุฉ**: ูุฌููุน `(maxStudents - studentsCount)`

## ๐ Data Flow

### ุฅุถุงูุฉ ุตู:
```
ุงููุฏุฑุณ ูููุฃ ุงููููุฐุฌ
    โ
handleSubmit()
    โ
addDoc(collection(db, 'classes'), data)
    โ
loadClasses() (ุชุญุฏูุซ ุงููุงุฆูุฉ)
    โ
ุนุฑุถ ุงูุตู ุงูุฌุฏูุฏ
```

### ุชุนุฏูู ุตู:
```
ุงููุฏุฑุณ ูุถุบุท ุนูู โ๏ธ
    โ
handleEdit() (ุชุนุจุฆุฉ ุงููููุฐุฌ)
    โ
ุงููุฏุฑุณ ูุนุฏู ุงูุจูุงูุงุช
    โ
handleSubmit()
    โ
updateDoc(doc(db, 'classes', id), data)
    โ
loadClasses() (ุชุญุฏูุซ ุงููุงุฆูุฉ)
```

### ุญุฐู ุตู:
```
ุงููุฏุฑุณ ูุถุบุท ุนูู ๐๏ธ
    โ
confirm('ูู ุฃูุช ูุชุฃูุฏุ')
    โ
handleDelete()
    โ
deleteDoc(doc(db, 'classes', id))
    โ
loadClasses() (ุชุญุฏูุซ ุงููุงุฆูุฉ)
```

## ๐ฏ Next Steps

### ููุชุฑุญุงุช ููุชุทููุฑ ุงููุณุชูุจูู:
1. **ุฑุจุท ุงูุทูุงุจ ุจุงูุตููู**:
   - ุนูุฏ ููุงููุฉ ุงููุฏุฑุณ ุนูู ุทูุจ ุงุดุชุฑุงูุ ุชุญุฏูุซ `studentsCount`
   - ุฅุถุงูุฉ ูุฌููุนุฉ `enrollments` ูุชุชุจุน ุงูุทูุงุจ ูู ูู ุตู

2. **ุชุญุฏูุซ ุชููุงุฆู ูู `studentsCount`**:
   ```typescript
   // ุนูุฏ ูุจูู ุทุงูุจ
   await updateDoc(doc(db, 'classes', classId), {
     studentsCount: increment(1)
   });
   ```

3. **ุตูุฑ ููุตููู**:
   - ุฅุถุงูุฉ ุญูู `imageUrl` ูู ุงูู schema
   - ุงูุณูุงุญ ูููุฏุฑุณ ุจุฑูุน ุตูุฑุฉ ุชูุถูุญูุฉ ููุตู

4. **ุฌุฏูู ุฒููู**:
   - ุชุญููู `schedule` ูู ูุต ุฅูู array ูู ุงูุฃูุงู ูุงูุฃููุงุช
   - ุฅุถุงูุฉ validation ููุชุฃูุฏ ูู ุนุฏู ุงูุชุนุงุฑุถ

5. **ุชููููุงุช ุงูุตููู**:
   - ุงูุณูุงุญ ููุทูุงุจ ุจุชูููู ุงูุตู ุจุนุฏ ุงูุชูุงุฆู
   - ุนุฑุถ ูุชูุณุท ุงูุชููููุงุช

6. **ุฃุฑุดูุฉ ุงูุตููู**:
   - ุจุฏูุงู ูู ุงูุญุฐูุ ููู ุงูุตููู ุงููุฏููุฉ ุฅูู archive
   - ุฅุถุงูุฉ ุญูู `status: 'active' | 'archived' | 'completed'`

## ๐ Troubleshooting

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุตููู
**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงููุฏุฑุณ ูุงู ุจุชุณุฌูู ุงูุฏุฎูู
- ุชุฃูุฏ ูู ุฃู `teacherId` ูู ุงูุตู ูุทุงุจู `user.uid`
- ุงูุญุต Firebase Console ููุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช

### ุงููุดููุฉ: ุฎุทุฃ ูู ุงูุตูุงุญูุงุช (Permission denied)
**ุงูุญู:**
- ุชุฃูุฏ ูู ูุดุฑ `firestore.rules` ูู Firebase Console
- ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู role ุตุญูุญ (`teacher`)

### ุงููุดููุฉ: ุงูุตููู ูุง ุชุชุญุฏุซ ุจุนุฏ ุงูุฅุถุงูุฉ
**ุงูุญู:**
- ุชุฃูุฏ ูู ุงุณุชุฏุนุงุก `loadClasses()` ุจุนุฏ `addDoc`
- ุงูุญุต Console ููุฃุฎุทุงุก

## โ Testing Checklist

- [ ] ุงููุฏุฑุณ ููููู ุฅุถุงูุฉ ุตู ุฌุฏูุฏ
- [ ] ุงููุฏุฑุณ ููููู ุชุนุฏูู ุตูููู
- [ ] ุงููุฏุฑุณ ููููู ุญุฐู ุตูููู
- [ ] ุงููุฏุฑุณ ูุง ููููู ุญุฐู/ุชุนุฏูู ุตููู ูุฏุฑุณูู ุขุฎุฑูู
- [ ] ุงูุทูุงุจ ูููููู ุนุฑุถ ุงูุตููู ุงููุชุงุญุฉ
- [ ] ุงูุตููู ุบูุฑ ุงููุดุทุฉ ูุง ุชุธูุฑ ูู ุงูุตูุญุฉ ุงูุนุงูุฉ
- [ ] ุงูุฅุญุตุงุฆูุงุช ุชุนุฑุถ ุงูุจูุงูุงุช ุงูุตุญูุญุฉ
- [ ] ุฑุณุงูุฉ "ูุง ุชูุฌุฏ ุตููู" ุชุธูุฑ ุนูุฏ ุนุฏู ูุฌูุฏ ุตููู
- [ ] Modal ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู ูุนูู ุจุดูู ุตุญูุญ
- [ ] ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุนูู (required fields)

## ๐ Related Documentation
- [SUBSCRIPTION_SYSTEM.md](./SUBSCRIPTION_SYSTEM.md) - ูุธุงู ุงูุงุดุชุฑุงูุงุช
- [TEACHER_PAGES.md](./TEACHER_PAGES.md) - ุตูุญุงุช ุงููุฏุฑุณ
- [Firebase Firestore Documentation](https://firebase.google.com/docs/firestore)
