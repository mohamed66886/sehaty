# تحديث نظام الامتحانات

## التغييرات المنفذة

### 1. تحديث أنواع البيانات (Types)
تم تحديث `src/types/index.ts`:
- إضافة خاصية `order` للأسئلة لترتيبها
- إضافة خاصية `class` للامتحان لتحديد الصف
- إضافة خاصية `showResultsImmediately` لتحديد متى تظهر النتيجة:
  - `true`: عرض النتيجة فوراً بعد الانتهاء من الامتحان
  - `false`: عرض النتيجة بعد مراجعة المعلم
- تحديث نوع `Question.type` ليشمل:
  - `multiple_choice`: سؤال اختياري (اختيار من متعدد)
  - `true_false`: سؤال صح/خطأ
  - `essay`: سؤال مقالي (يتطلب مراجعة يدوية)

### 2. تقسيم صفحات الامتحانات

#### أ) الصفحة الرئيسية (`/dashboard/teacher/exams/page.tsx`)
**الوظيفة**: عرض قائمة الامتحانات الموجودة
- عرض جميع الامتحانات الخاصة بالمعلم
- إحصائيات سريعة:
  - إجمالي الامتحانات
  - الامتحانات القادمة
  - الامتحانات النشطة حالياً
- كل امتحان يعرض:
  - العنوان والمادة
  - التاريخ والوقت (البداية والنهاية)
  - المدة
  - عدد الطلاب
  - عدد الأسئلة
  - الدرجة الكلية
  - حالة الامتحان (قادم/نشط/منتهي)
- زر لإنشاء امتحان جديد
- زر لتعديل كل امتحان
- زر لعرض نتائج كل امتحان

#### ب) صفحة التفاصيل (`/dashboard/teacher/exams/[id]/page.tsx`)
**الوظيفة**: إنشاء امتحان جديد أو تعديل امتحان موجود

**معلومات الامتحان الأساسية**:
- عنوان الامتحان
- المادة
- **الصف**: اختيار من الصفوف التي يدرّسها المعلم الحالي
- المدة بالدقائق
- تاريخ ووقت البدء (datetime-local)
- تاريخ ووقت الانتهاء (datetime-local)
- **خيار عرض النتيجة**: 
  - فوراً بعد الانتهاء (Switch button)
  - أو بعد المراجعة اليدوية

**إدارة الأسئلة**:

##### 1. السؤال الاختياري (Multiple Choice)
- نص السؤال (TextArea)
- 4 خيارات افتراضية (A, B, C, D)
- اختيار الإجابة الصحيحة من الخيارات (Radio buttons)
- الدرجة

##### 2. سؤال صح/خطأ (True/False)
- نص السؤال (TextArea)
- خيارين فقط: صح أو خطأ
- اختيار الإجابة الصحيحة (Radio buttons)
- الدرجة

##### 3. السؤال المقالي (Essay)
- نص السؤال (TextArea)
- **لا توجد خيارات أو إجابة محددة**
- رسالة تحذيرية: "السؤال المقالي يتطلب مراجعة يدوية من المعلم"
- الدرجة

**مميزات إضافية**:
- ترتيب تلقائي للأسئلة
- حذف أي سؤال
- عرض الدرجة الكلية تلقائياً (مجموع درجات جميع الأسئلة)
- التحقق من صحة البيانات:
  - وجود نص للسؤال
  - وجود خيارات كافية للأسئلة الاختيارية
  - تحديد الإجابة الصحيحة (للأسئلة الاختيارية وصح/خطأ)
  - وجود طلاب في الصف المحدد

### 3. اختيار الطلاب التلقائي
- بمجرد اختيار الصف، يتم تلقائياً تحديد جميع الطلاب في ذلك الصف
- يتم فلترة الطلاب من قاعدة البيانات حسب:
  - الطلاب الذين يدرسهم المعلم الحالي
  - الطلاب في الصف المحدد

### 4. التنقل بين الصفحات
- من القائمة → "إنشاء امتحان جديد" → `/dashboard/teacher/exams/new`
- من القائمة → "تعديل الامتحان" → `/dashboard/teacher/exams/[examId]`
- من صفحة التفاصيل → "العودة للقائمة" → `/dashboard/teacher/exams`
- بعد الحفظ بنجاح → تلقائياً إلى `/dashboard/teacher/exams`

### 5. التحقق من الصلاحيات
- عند تعديل امتحان موجود، يتم التحقق من أن المعلم الحالي هو من أنشأ الامتحان
- إذا كان الامتحان لمعلم آخر، يتم رفض الوصول والعودة للقائمة

## طريقة الاستخدام

### إنشاء امتحان جديد:
1. اذهب إلى `/dashboard/teacher/exams`
2. اضغط "إنشاء امتحان جديد"
3. املأ معلومات الامتحان الأساسية
4. اختر الصف من القائمة المنسدلة
5. حدد هل تريد عرض النتيجة فوراً أم لا
6. اضغط "إضافة سؤال" لكل سؤال:
   - اختر نوع السؤال (اختياري/صح-خطأ/مقالي)
   - اكتب نص السؤال
   - حسب النوع، أضف الخيارات واختر الإجابة الصحيحة
   - حدد الدرجة
7. راجع الدرجة الكلية
8. اضغط "إنشاء الامتحان"

### تعديل امتحان موجود:
1. من قائمة الامتحانات، اضغط "تعديل الامتحان"
2. ستظهر جميع البيانات محملة مسبقاً
3. قم بالتعديلات المطلوبة
4. اضغط "حفظ التعديلات"

## ملاحظات مهمة

### الأسئلة المقالية:
- لا يمكن تصحيحها تلقائياً
- تتطلب مراجعة يدوية من المعلم
- يجب على المعلم الدخول إلى صفحة النتائج وتقييم إجابة كل طالب يدوياً

### عرض النتائج:
- **فوراً**: مناسب للامتحانات التي تحتوي على أسئلة اختيارية وصح/خطأ فقط
- **بعد المراجعة**: مناسب للامتحانات التي تحتوي على أسئلة مقالية

### التوافق مع Firebase:
- جميع التواريخ يتم تحويلها إلى `Timestamp` قبل الحفظ
- عند القراءة، يتم تحويلها إلى `Date` للعرض
- يتم حفظ الأسئلة كمصفوفة في وثيقة الامتحان

## الخطوات التالية المقترحة

1. **صفحة عرض النتائج**: تطوير واجهة لعرض نتائج الطلاب وتصحيح الأسئلة المقالية
2. **واجهة الطالب**: صفحة لأداء الامتحان من جانب الطالب
3. **إشعارات**: إرسال إشعارات للطلاب عند نشر امتحان جديد
4. **تقارير**: إحصائيات تفصيلية عن أداء الطلاب
5. **بنك الأسئلة**: حفظ الأسئلة لإعادة استخدامها في امتحانات أخرى
