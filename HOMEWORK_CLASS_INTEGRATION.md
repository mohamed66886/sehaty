# دمج الواجبات مع نظام إدارة الصفوف

## التحديث الجديد

تم دمج صفحة الواجبات المنزلية مع نظام إدارة الصفوف، بحيث يتم اختيار الصف والمادة من الصفوف المسجلة في النظام.

## الميزات الجديدة

### 1. اختيار الصف من القائمة
- يظهر للمعلم قائمة بجميع الصفوف التي أنشأها في صفحة "إدارة الصفوف"
- كل خيار يعرض: `اسم الصف - المادة`
- مثال: `الصف الأول الثانوي - المجموعة A - الرياضيات`

### 2. المادة تلقائية
- عند اختيار الصف، تظهر المادة تلقائياً
- حقل المادة **غير قابل للتعديل** (disabled)
- تأخذ المادة من بيانات الصف المختار

### 3. تصفية الطلاب
- يتم تصفية الطلاب تلقائياً حسب اسم الصف المختار
- يظهر فقط الطلاب المنتمين للصف المحدد
- زر "تحديد الكل" يعمل فقط للطلاب المصفاة

## كيفية الاستخدام

### خطوات إضافة واجب جديد:

1. **اضغط على "إضافة واجب جديد"**

2. **أدخل عنوان الواجب**
   - مثال: "حل تمارين الجبر صفحة 45"

3. **أدخل وصف الواجب**
   - تفاصيل الواجب والتعليمات

4. **اختر الصف**
   - اختر من القائمة المنسدلة
   - ستظهر المادة تلقائياً

5. **حدد التواريخ**
   - تاريخ البدء
   - تاريخ الانتهاء

6. **أرفق الملفات (اختياري)**
   - صور، فيديوهات، أو مستندات

7. **اختر الطلاب**
   - اختر الطلاب المطلوبين
   - أو اضغط "تحديد الكل"

8. **احفظ الواجب**

## البنية التقنية

### التكامل مع Firestore

```typescript
// تحميل الصفوف من Firestore
const classesRef = collection(db, 'classes');
const classesQuery = query(classesRef, where('teacherId', '==', user.uid));
const classesSnapshot = await getDocs(classesQuery);
```

### تصفية الطلاب

```typescript
// تصفية الطلاب حسب اسم الصف
const selectedClass = classes.find(c => c.id === selectedClassId);
const filteredStudents = selectedClass 
  ? students.filter(s => s.class === selectedClass.name)
  : [];
```

### حفظ الواجب

```typescript
await addDoc(homeworkRef, {
  teacherId,
  title: values.title,
  description: values.description,
  subject: selectedClass?.subject || '',  // تلقائي من الصف
  class: selectedClass?.name || '',        // اسم الصف
  startDate: Timestamp.fromDate(new Date(values.startDate)),
  deadline: Timestamp.fromDate(new Date(values.deadline)),
  studentIds: values.studentIds,
  attachments: uploadedFiles,
  submissions: [],
  createdAt: Timestamp.now(),
});
```

## الفوائد

### 1. تناسق البيانات
- جميع البيانات تأتي من مصدر واحد
- لا تناقض بين أسماء الصفوف والمواد

### 2. سهولة الاستخدام
- لا حاجة لكتابة اسم المادة يدوياً
- تقليل الأخطاء الإملائية

### 3. تنظيم أفضل
- ارتباط واضح بين الواجبات والصفوف
- سهولة التتبع والإدارة

### 4. مرونة
- يمكن للمعلم إنشاء صفوف متعددة لنفس المادة
- كل صف له واجباته الخاصة

## المتطلبات

### قبل استخدام نظام الواجبات:

1. **إنشاء الصفوف أولاً**
   - اذهب إلى "إدارة الصفوف"
   - أضف الصفوف المطلوبة مع المواد

2. **تسجيل الطلاب**
   - تأكد من تسجيل الطلاب في الصفوف الصحيحة

3. **ربط الطلاب بالمعلم**
   - تأكد من أن الطلاب مرتبطين بحساب المعلم

## ملاحظات مهمة

⚠️ **إذا لم تظهر الصفوف:**
- تأكد من إنشاء صفوف في "إدارة الصفوف" أولاً
- تأكد من أن الصفوف نشطة

⚠️ **إذا لم يظهر الطلاب:**
- تأكد من أن حقل `class` في بيانات الطالب يطابق اسم الصف بالضبط
- تأكد من أن الطلاب مرتبطين بحساب المعلم

⚠️ **للحصول على أفضل تجربة:**
- استخدم أسماء واضحة للصفوف
- نظم الصفوف بطريقة منطقية
- حافظ على تطابق البيانات بين الصفوف والطلاب

## مثال عملي

### سيناريو:
معلم رياضيات لديه ثلاث مجموعات:
- الصف الأول الثانوي - مجموعة A
- الصف الأول الثانوي - مجموعة B  
- الصف الثاني الثانوي

### الخطوات:

1. **في صفحة "إدارة الصفوف":**
   ```
   الصف: الصف الأول الثانوي - مجموعة A
   المادة: الرياضيات
   الطلاب: 25 طالب
   ```

2. **في صفحة "الواجبات المنزلية":**
   - اختر: "الصف الأول الثانوي - مجموعة A - الرياضيات"
   - المادة تظهر تلقائياً: "الرياضيات"
   - الطلاب المتاحين: 25 طالب فقط من هذه المجموعة

3. **النتيجة:**
   - واجب منظم مرتبط بالصف الصحيح
   - لا خلط بين المجموعات
   - تتبع دقيق لكل مجموعة

## الدعم الفني

إذا واجهت أي مشاكل:
1. تأكد من وجود صفوف نشطة
2. تأكد من تطابق أسماء الصفوف
3. راجع console للأخطاء
4. تأكد من صلاحيات Firestore
